<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fallout FoundryVTT Server Status</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #1e1e1e;
            color: white;
            margin: 0;
            padding: 0;
        }
        #server-status {
            margin: 50px auto;
        }
        #status-image {
            width: 300px;
            height: auto;
            cursor: not-allowed;
        }
        #logo {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 100px;
        }
        #social-links {
            position: absolute;
            bottom: 10px;
            left: 10px;
        }
        #social-links a {
            color: white;
            margin-right: 10px;
            text-decoration: none;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <img id="logo" src="creator_logo.png" alt="Creator Logo">
    
    <div id="server-status">
        <a id="server-link" href="#" target="_blank">
            <img id="status-image" src="offline.png" alt="Server Offline">
        </a>
        <p id="status-text">Checking server status...</p>
    </div>
    
    <div id="social-links">
        <a href="https://discord.gg/NtXEEJRbH4" target="_blank">Discord</a>
        <a href="https://www.twitch.tv/CloudheartTV" target="_blank">Twitch</a>
        <a href="https://www.youtube.com/Cloudharte" target="_blank">YouTube</a>
        <a href="https://steamcommunity.com/id/Cloudheart/" target="_blank">Steam</a>
    </div>
    
    <script>
        async function checkServerStatus() {
            const foundryLocalURL = "http://localhost:30000"; // FoundryVTT local check
            const serverURL = "https://cloudheartfoundry.duckdns.org/"; // Your actual server URL
            
            const isFoundryRunning = await checkFoundryProcess(foundryLocalURL);
            if (!isFoundryRunning) {
                console.log("FoundryVTT is NOT running locally. Marking server as offline.");
                updateStatus(false);
                return;
            }

            try {
                const response = await fetch(serverURL, { mode: 'no-cors' });

                if (response.ok) {
                    updateStatus(true);
                } else {
                    updateStatus(false);
                }
            } catch (error) {
                updateStatus(false);
            }
        }

        async function checkFoundryProcess(url) {
            try {
                const response = await fetch(url, { mode: 'no-cors' });
                return response.ok; // Returns true if FoundryVTT is running
            } catch (error) {
                return false; // FoundryVTT is not running locally
            }
        }

        function updateStatus(isOnline) {
            const statusImage = document.getElementById("status-image");
            const statusText = document.getElementById("status-text");
            const serverLink = document.getElementById("server-link");

            if (isOnline) {
                statusImage.src = "online.png";
                statusText.innerText = "Server Online! Click to Join.";
                serverLink.href = "https://cloudheartfoundry.duckdns.org/";
                statusImage.style.cursor = "pointer";
            } else {
                statusImage.src = "offline.png";
                statusText.innerText = "Server Offline";
                serverLink.removeAttribute("href");
                statusImage.style.cursor = "not-allowed";
            }
        }

        // Run the status check when the page loads
        checkServerStatus();
    </script>
</body>
</html>
